<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENARC-I</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <h1 align="center">GENARC-I</h1>
    <div class="body-container">
        <div class="form-container">
            <div>
                <label for="username">Kullanıcı Adı:</label>
                <input type="text" id="username" placeholder="Kullanıcı Adı">
                <br><br>
            </div>
            
            <div>
                <label for="usernumber">Kullanıcı Sifresi:</label>
                <input type="text" id="usernumber" placeholder="Kullanıcı Sifresi">
                <br><br>
            </div>

            <div>
                <label for="subregion">Subregion Seçin:</label>
                <select id="subregion">
                    <option value="Europe">Europe</option>
                    <option value="North America">North America</option>
                    <option value="Asia">Asia</option>
                    <option value="South America">South America</option>
                    <option value="Africa">Africa</option>
                    <option value="Oceania">Oceania</option>
                    <option value="Middle East">Middle East</option>
                    <option value="Central America">Central America</option>
                    <option value="Caribbean">Caribbean</option>
                    <option value="Antarctica">Antarctica</option>
                </select>
                <br><br>
            </div>
            
            <div>
                <label for="architect">Ünlü Bir Mimar Seçin:</label>
                <select id="architect">
                    <option value="Frank Lloyd Wright">Frank Lloyd Wright</option>
                    <option value="Zaha Hadid">Zaha Hadid</option>
                    <option value="Le Corbusier">Le Corbusier</option>
                    <option value="Ludwig Mies van der Rohe">Ludwig Mies van der Rohe</option>
                    <option value="Frank Gehry">Frank Gehry</option>
                    <option value="Santiago Calatrava">Santiago Calatrava</option>
                    <option value="Rem Koolhaas">Rem Koolhaas</option>
                    <option value="Norman Foster">Norman Foster</option>
                    <option value="I. M. Pei">I. M. Pei</option>
                    <option value="Tadao Ando">Tadao Ando</option>
                </select>
                <br><br>
            </div>
            
            <div>
                <label for="imageUpload">Bir resim yükleyin (Opsiyonel):</label>
                <input type="file" id="imageUpload" accept="image/*"><br><br>
            </div>
            
            <div>
                <input type="button" value="Gönder" onclick="sendRequest()">
            </div>
        </div>

        <div class="image-container">
            <h3 align="center">Generated Image:</h3>
            <img id="generatedImage" class="centered-image"><br><br>
            <canvas id="imageCanvas" width="512" height="512" style="border: 1px solid black; display: none;"></canvas><br><br>
        </div>
    </div>

    <script>
        let imageLoaded = false;

        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.getElementById('imageCanvas');
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                    
                        for (let i = 0; i < data.length; i += 4) {
                            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                            data[i] = avg;
                            data[i + 1] = avg;
                            data[i + 2] = avg;
                        }
                    
                        ctx.putImageData(imageData, 0, 0);
                        imageLoaded = true;
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        async function sendRequest() {
            const username = document.getElementById('username').value;
            const usernumber = document.getElementById('usernumber').value;
            const subregion = document.getElementById('subregion').value;
            const architect = document.getElementById('architect').value;

            if (!username || !usernumber) {
                alert("Lütfen kullanıcı adını ve şifresini girin.");
                return;
            }

            const canvas = document.getElementById('imageCanvas');
            let sketch = await new Promise((resolve) => {
                if (imageLoaded) { 
                    canvas.toBlob((blob) => {
                        resolve(blob);
                    }, 'image/jpeg');
                }
                else {
                    resolve(null);
                }
            });

            const data = new FormData();
            if (sketch) {
                data.append("sketch", sketch)
            }
            data.append("subregion", subregion)
            data.append("architect", architect)
            
            try {
                response = await fetch("http://194.27.127.220:80/generateImage", {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + btoa(username + ":" + usernumber)
                    },
                    body: data
                })

                const result = await response.blob();
                const imageUrl = window.URL.createObjectURL(result);
                const generatedImage = document.getElementById('generatedImage');
                generatedImage.src = imageUrl;
                generatedImage.style.display = 'block';
            } catch (error) {
                console.error('Error: ', error);
            }
        }
    </script>
</body>
</html>